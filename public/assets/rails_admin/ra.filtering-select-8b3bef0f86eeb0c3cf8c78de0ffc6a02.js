!function(t){t.widget("ra.filteringSelect",{options:{createQuery:function(t){return{query:t}},minLength:0,searchDelay:200,remote_source:null,source:null,xhr:!1},_create:function(){var e=this,n=this.element.hide(),i=n.children(":selected"),o=i.val()?i.text():"";this.options.source=this.options.xhr?this.options.remote_source:n.children("option").map(function(){return{label:t(this).text(),value:this.value}}).toArray();var a=t('<div class="input-group filtering-select col-sm-2" style="float:left"></div>'),l=this.input=t('<input type="text">').val(o).addClass("form-control ra-filtering-select-input").attr("style",n.attr("style")).show().autocomplete({delay:this.options.searchDelay,minLength:this.options.minLength,source:this._getSourceFunction(this.options.source),select:function(i,o){var a=t("<option></option>").attr("value",o.item.id).attr("selected","selected").text(o.item.value);n.html(a),n.trigger("change",o.item.id),e._trigger("selected",i,{item:a}),t(e.element.parents(".controls")[0]).find(".update").removeClass("disabled")},change:function(i,o){if(!o.item){var a=new RegExp("^"+t.ui.autocomplete.escapeRegex(t(this).val())+"$","i"),s=!1;if(n.children("option").each(function(){return t(this).text().match(a)?(this.selected=s=!0,!1):void 0}),!s||""==t(this).val())return t(this).val(null),n.html(t('<option value="" selected="selected"></option>')),l.data("ui-autocomplete").term="",t(e.element.parents(".controls")[0]).find(".update").addClass("disabled"),!1}}}).keyup(function(){0==t(this).val().length&&(n.html(t('<option value="" selected="selected"></option>')),n.trigger("change"))});n.attr("placeholder")&&l.attr("placeholder",n.attr("placeholder")),l.data("ui-autocomplete")._renderItem=function(e,n){return t("<li></li>").data("ui-autocomplete-item",n).append(t("<a></a>").html(n.html||n.id)).appendTo(e)};var s=this.button=t('<span class="input-group-btn"><label class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Show All Items" role="button"><span class="caret"></span><span class="ui-button-text">&nbsp;</span></label></span>').click(function(){return l.autocomplete("widget").is(":visible")?void l.autocomplete("close"):(l.autocomplete("search",""),void l.focus())});a.append(l).append(s).insertAfter(n)},_getResultSet:function(e,n,i){var o=new RegExp(t.ui.autocomplete.escapeRegex(e.term),"i"),a=function(e,n){return n.length>0?t.map(e.split(n),function(e){return t("<span></span>").text(e).html()}).join(t("<strong></strong>").text(n)[0].outerHTML):t("<span></span>").text(e).html()};return t.map(n,function(t){return(t.id||t.value)&&(i||o.test(t.label))?{html:a(t.label||t.id,e.term),value:t.label||t.id,id:t.id||t.value}:void 0})},_getSourceFunction:function(e){var n=this,i=0;return t.isArray(e)?function(t,i){i(n._getResultSet(t,e,!1))}:"string"==typeof e?function(o,a){this.xhr&&this.xhr.abort(),this.xhr=t.ajax({url:e,data:n.options.createQuery(o.term),dataType:"json",autocompleteRequest:++i,success:function(t){this.autocompleteRequest===i&&a(n._getResultSet(o,t,!0))},error:function(){this.autocompleteRequest===i&&a([])}})}:e},destroy:function(){this.input.remove(),this.button.remove(),this.element.show(),t.Widget.prototype.destroy.call(this)}})}(jQuery);