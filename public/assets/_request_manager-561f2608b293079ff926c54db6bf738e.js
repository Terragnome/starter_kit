(function(){var t;t=function(){function t(){}return t.prototype.parse=function(t){return this._get_parser()(t)},t.prototype._get_parser=function(){return null!=this._document_parser?this._document_parser:this._document_parser=this._parser_factory()},t.prototype._parser_factory=function(){var e,n,r,i,o,s;n=function(e){return(new t).parseFromString(e,"text/html")},e=function(t){var e;return e=document.implementation.createHTMLDocument(""),e.documentElement.innerHTML=t,e},r=function(t){var e;return e=document.implementation.createHTMLDocument(""),e.open("replace"),e.write(t),e.close(),e};try{if(window.DOMParser)return o=n("<html><body><p>test"),n}catch(c){return i=c,o=e("<html><body><p>test"),e}finally{if(1!==(null!=o&&null!=(s=o.body)?s.childNodes.length:void 0))return r}},t}(),null==window._Wiselinks&&(window._Wiselinks={}),window._Wiselinks.DOMParser=t}).call(this),function(){var t;t=function(){function t(t,e,n){this.html=t,this.xhr=e,this.$target=n}return t._document_parser=null,t._get_document_parser=function(){return null!=t._document_parser?t._document_parser:t._document_parser=new window._Wiselinks.DOMParser},t.prototype.url=function(){return this.xhr.getResponseHeader("X-Wiselinks-Url")},t.prototype.assets_digest=function(){return this._is_full_document_response()?$('meta[name="assets-digest"]',this._get_doc()).attr("content"):this.xhr.getResponseHeader("X-Wiselinks-Assets-Digest")},t.prototype.content=function(){return null!=this._content?this._content:this._content=this._extract_content()},t.prototype.title=function(){return null!=this._title?this._title:this._title=this._extract_title()},t.prototype._extract_title=function(){return this._is_full_document_response()?$("title",this._get_doc()).text():this.xhr.getResponseHeader("X-Wiselinks-Title")},t.prototype.description=function(){return null!=this._description?this._description:this._description=this._extract_description()},t.prototype._extract_description=function(){return this._is_full_document_response()?$('meta[name="description"]',this._get_doc()).text():this.xhr.getResponseHeader("X-Wiselinks-Description")},t.prototype._extract_content=function(){return this._is_full_document_response()?this._get_doc_target_node().html():this.html},t.prototype._is_full_document_response=function(){return 1===this._get_doc_target_node().length},t.prototype._get_doc_target_node=function(){return null!=this.$doc_target_node?this.$doc_target_node:this.$doc_target_node=$(this.$target.selector,this._get_doc())},t.prototype._get_doc=function(){return null!=this._doc?this._doc:this._doc=t._get_document_parser().parse(this.html)},t}(),null==window._Wiselinks&&(window._Wiselinks={}),window._Wiselinks.Response=t}.call(this),function(){var t;t=function(){function t(t){this.options=null!=t?t:{}}return t.prototype.call=function(t,e){var n;return n=this,null!=this.redirected?void(this.redirected=null):(n._loading(t,e),$.ajax({url:e.url,headers:{"X-Wiselinks":e.data.render,"X-Wiselinks-Referer":e.data.referer},dataType:"html"}).done(function(e,r,i){return n._html_loaded(t,e,r,i)}).fail(function(r,i,o){return n._fail(t,i,e,o,r.status)}).always(function(r,i){return n._always(t,i,e)}))},t.prototype._normalize=function(t){return null!=t?t=t.replace(/\/+$/,""):void 0},t.prototype._assets_changed=function(t){return null!=this.options.assets_digest&&this.options.assets_digest!==t},t.prototype._redirect_to=function(t,e,n,r){return r&&r.readyState<4&&(r.onreadystatechange=$.noop,r.abort()),this.redirected=!0,$(document).trigger("page:redirected",[e,n.data.render,t]),History.replaceState(n.data,document.title,t)},t.prototype._loading=function(t,e){return $(document).trigger("page:loading",[t,e.data.render,decodeURI(e.url)])},t.prototype._done=function(t,e,n,r){return $(document).trigger("page:done",[t,e,decodeURI(n.url),r])},t.prototype._html_loaded=function(t,e,n,r){var i,o,s,c;return o=new window._Wiselinks.Response(e,r,t),c=this._normalize(o.url()),i=o.assets_digest(),this._assets_changed(i)?window.location.reload(!0):(s=History.getState(),null!=c&&c!==this._normalize(s.url)&&this._redirect_to(c,t,s,r),t.html(o.content()).promise().done(function(e){return function(){return e._title(o.title()),e._description(o.description()),e._done(t,n,s,o.content())}}(this)))},t.prototype._fail=function(t,e,n,r,i){return $(document).trigger("page:fail",[t,e,decodeURI(n.url),r,i])},t.prototype._always=function(t,e,n){return $(document).trigger("page:always",[t,e,decodeURI(n.url)])},t.prototype._title=function(t){return null!=t?($(document).trigger("page:title",decodeURI(t)),document.title=decodeURI(t)):void 0},t.prototype._description=function(t){return null!=t?($(document).trigger("page:description",decodeURI(t)),$('meta[name="description"]').attr("content",decodeURI(t))):void 0},t}(),void 0===window._Wiselinks&&(window._Wiselinks={}),window._Wiselinks.RequestManager=t}.call(this);